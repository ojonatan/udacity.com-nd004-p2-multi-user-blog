{% extends "base.html" %}

{% block content %}

	{% for post in posts.order('-created') %}
    <div class="post">
        <span style="float: right">{{post.created}}</span>
		{% if post.cover_image %}
        <div class="cover-image" style="background-image: url({{ image_url_prefix }}{{ post.cover_image.blob_key.key() }})"></div>
		{% else %}
        <div class="cover-image"></div>
		{% endif %}
        <h2>{{post.subject}}</h2>
        <div style="clear: both;">Author: {{post.user.username}}</div>
        <div>{{post.summary}}</div>

        <a href="{{url_prefix}}post/{{post.key().id()}}" data-blog-control="get-post-view">read more</a><br>

		{% if user.legit and user.username != post.user.username %}
		<form action="{{url_prefix}}post/{{post.key().id()}}/like" method="post" data-blog-form="post-post-like">
			{% if user.liked_posts.filter('post = ',post.key()).count() == 1 %}
			<button type="submit" data-blog-control="post-unlike">Unlike!</button>
			{% else %}
			<button type="submit" data-blog-control="post-like">Like!</button>
			{% endif %}
		</form>
		{% endif %}
    </div>
    <hr />
	{% endfor %}

	{% if user.legit %}
<a href="{{url_prefix}}newpost" data-blog-control="get-post-create">new post!!</a>
	{% endif %}

{% endblock %}
